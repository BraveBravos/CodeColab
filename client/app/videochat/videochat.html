<div class='video-chat-area'>
<div class='video-chats-area'>
      <div id='video-chats'>
        <div id='remote-media-streams'></div>
        <div id='local-media-stream'></div>
      </div>
  </div>
  <div id='setup-new-meeting'>Join Video Chat</div>
<div id='leave-current-meeting' class='hidden'>Leave Video Chat</div> 

<!-- <button id="openNewSessionButton">Open New Room</button> -->
<script>

var CHANNEL_ID = 'chat-codecolab' + window.RMCDefaultChannel; 

var SESSION_ID = 'vidchat';    // room-id
var USER_ID         = 'initiator';    // user-id
var SESSION    = {         // media-type
    audio: true,
    video: true
};
var EXTRA      = {};       // empty extra-data


var connection = new RTCMultiConnection(CHANNEL_ID);
connection.sessionid = SESSION_ID;
//connection.userid = USER_ID;
connection.extra = EXTRA;

var firebaseURL = 'https://glaring-fire-1858.firebaseio.com/';

var remoteMediaStreams = document.getElementById('video-chats');
var localMediaStream = document.getElementById('local-media-stream');
var ctrlJoin = document.getElementById('setup-new-meeting');
var ctrlLeave = document.getElementById('leave-current-meeting');

// easiest way to customize what you need!
connection.session = {
    audio: true,
    video: true
};

// on getting local or remote media stream
connection.onstream = function(e) {
    console.log('connection.onstream e = ',e);
    if(e.type === 'local'){
      localMediaStream.insertBefore(e.mediaElement, localMediaStream.firstChild);
       e.mediaElement.className = 'my-video';
    }else if(e.type === 'remote'){
      remoteMediaStreams.insertBefore(e.mediaElement, remoteMediaStreams.firstChild);
      e.video.className = 'their-video';
    }
    //document.body.appendChild(e.mediaElement);
};



// open new session
// document.querySelector('#openNewSessionButton').onclick = function() {
//     connection.open();
// };
document.getElementById('setup-new-meeting').onclick = function(){
  // setup signaling channel
  var roomFirebase = new Firebase(firebaseURL + connection.channel + '-session');
  roomFirebase.once('value', function (data) {
    var sessionDescription = data.val();

    // checking for room; if not available "open" otherwise "join"
    if (sessionDescription == null) {
        connection.open({
            sessionid: connection.sessionid,
            captureUserMediaOnDemand: false,
            dontTransmit: true,
            onMediaCaptured: function() {
                // storing room on server
                roomFirebase.set(connection.sessionDescription);
                
                // if room owner leaves; remove room from the server
                //roomFirebase.onDisconnect().remove();
            }
        });
    } else {
        // you can join with only audio or audio+video
        var joinWith = {
            audio: true,
            video: true
        };
        
        // pure "sessionDescription" object is passed over "join" method
        // 2nd parameter is optional which allows you customize how to join the session
        connection.join(sessionDescription, joinWith);

    }
  });
  ctrlJoin.className = 'hidden';
  ctrlLeave.className = 'shown';
}


document.getElementById('leave-current-meeting').onclick = function(){
  connection.leave();
  ctrlJoin.className = 'shown';
  ctrlLeave.className = 'hidden';
}
</script>
